# Dev image cho Next.js 15 + React 19
FROM node:20-bookworm-slim

WORKDIR /app

# Cài deps trước để cache tốt (nếu có package-lock.json thì dùng npm ci cho reproducible)
COPY package*.json ./
RUN npm ci || npm install

# Copy source
COPY . .

# Cho watcher ổn định khi bind volume (Win/Mac)
ENV HOST=0.0.0.0 \
    WATCHPACK_POLLING=true \
    CHOKIDAR_USEPOLLING=1 \
    NEXT_TELEMETRY_DISABLED=1 \
    TZ=Asia/Ho_Chi_Minh

# Dev của bạn đang dùng PORT=4000
EXPOSE 4000
CMD ["bash", "-lc", "npm run dev -- -H 0.0.0.0 -p ${PORT:-4000}"]
